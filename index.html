<html>
<head>
	<link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<!-- Load the d3 library. -->
<script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
<script src="http://d3js.org/topojson.v1.min.js"></script>
<style type="text/css">
svg{ background-color: lightgrey;
}
.possent {
	fill:green;
}
.negsent {
	fill:red;
}
.neutralsent {
	fill:grey;
}
.yaxis{display:none;}
.tick text{font-size: 8pt;}
.states {
        	fill: #aaa;
        	stroke: #fff;
        	stroke-width: 0.75px;
	}
</style>
</head>
<body>
	<svg height = "900" width = "900"></svg>
	<script>
		var svg = d3.select("svg");
		var numTweets = [
			{"candidate":"Donald Trump","possent":0,"negsent":0,"neutralsent":0},
			{"candidate":"Ted Cruz","possent":0,"negsent":0,"neutralsent":0},
			{"candidate":"Marco Rubio","possent":0,"negsent":0,"neutralsent":0},
			{"candidate":"Ben Carson","possent":0,"negsent":0,"neutralsent":0},
			{"candidate":"Mike Huckabee","possent":0,"negsent":0,"neutralsent":0},
			{"candidate":"Chris Christie","possent":0,"negsent":0,"neutralsent":0},
			{"candidate":"John Kasich","possent":0,"negsent":0,"neutralsent":0},
			{"candidate":"Jeb Bush","possent":0,"negsent":0,"neutralsent":0},
			{"candidate":"Scott Walker","possent":0,"negsent":0,"neutralsent":0},
			{"candidate":"Rand Paul","possent":0,"negsent":0,"neutralsent":0}
			];

		var margin = {top: 20, right: 20, bottom: 70, left: 40};
    	var	width = 900- margin.left - margin.right;
    	var	height = 900 - margin.top - margin.bottom;
    	var h = svg.attr("height");
    	var w = svg.attr("width");


    	var x = d3.scale.ordinal().rangeRoundBands([0, width])
    			.domain(numTweets.map(function(d) { return d.candidate; }));
		var y = d3.scale.linear().domain([0,5000]).range([height,0]);
				

		var xAxis = d3.svg.axis()
   					.scale(x)
    				.orient("bottom");
    				
		var yAxis = d3.svg.axis()
    				.scale(y)
    				.orient("left")
    				.ticks(10);
		
    	svg.append("g").attr("class", "axis")
			.attr("transform","translate(0,"+y(0)+")")
			.call(xAxis);

		


		d3.csv("Sentiment.csv", function(error, rows){
			if(error){console.log(error);}
			
			//Function taken from stackoverflow user aston
			function changeDesc( candidate,sentiment ) {
  				for (var i in numTweets) {
     				if (numTweets[i].candidate == candidate) {
        				if(sentiment == "possent"){
        					numTweets[i].possent = numTweets[i].possent+1;
        				} else if(sentiment == "negsent"){
        					numTweets[i].negsent = numTweets[i].negsent+1;
        				} else {
        					numTweets[i].neutralsent = numTweets[i].neutralsent+1;
        				}
       					break; //Stop this loop, we found it!
     				}
  				}
			}
			rows.forEach(function(r){
				var candidate = r.candidate;
				if(r.sentiment == "Positive"){
					changeDesc(candidate,"possent");
				} else if(r.sentiment == "Negative") {
					changeDesc(candidate,"negsent");
				} else {
					changeDesc(candidate,"neutralsent");
				}
			});
			console.log(numTweets);

			numTweets.forEach(function(row) {

    			svg.append("rect")
					.attr("class","possent")
					.attr("x", x(row.candidate)+20)
					.attr("y",  y(row.possent) - margin.bottom - 20)
					.attr("height",900 - y(row.possent))
					.attr("width", 35);

				svg.append("text")
					.attr("x",x(row.candidate)+37.5)
					.attr("y",y(row.possent) - margin.bottom - 5)
					.attr("text-anchor","middle")
					.text(row.possent);

				svg.append("rect")
					.attr("class","negsent")
					.attr("x", x(row.candidate)+20)
					.attr("y",  y(row.negsent) - margin.bottom - 20 - (900-y(row.possent)))
					.attr("height",900 - y(row.negsent))
					.attr("width", 35);

				svg.append("text")
					.attr("x",x(row.candidate)+37.5)
					.attr("y",y(row.negsent) - margin.bottom - 5 - (900-y(row.possent)))
					.attr("text-anchor","middle")
					.text(row.negsent);

				svg.append("rect")
					.attr("class","neutralsent")
					.attr("x", x(row.candidate)+20)
					.attr("y",  y(row.neutralsent)- margin.bottom - 20 - (900-y(row.possent))-(900-y(row.negsent)))
					.attr("height",900 - y(row.neutralsent))
					.attr("width", 35);

				svg.append("text")
					.attr("x",x(row.candidate)+37.5)
					.attr("y",y(row.neutralsent)- margin.bottom - 5 - (900-y(row.possent))-(900-y(row.negsent)))
					.attr("text-anchor","middle")
					.text(row.neutralsent);
  			});
		});

		

	</script>

	<svg id = "map" height = "500" width = "960"></svg><br><br>
	<script>
	var projection = d3.geo.albersUsa()
		.scale(1100);

	var path = d3.geo.path()
		.projection(projection);

	var map = d3.select("#map")
    
    var g = map.append("g");
	var usObjects;
	
	d3.json("us-states.json", function(error, us) {
		g.selectAll("path")
                   .data(us.features)
                   .enter()
                   .append("path")
                   .attr("d", path)
                   .style("fill", "steelblue");
        console.log(us.features)
		

	
		g.selectAll("path").data(us.features)
		.on("mouseover", function (state) {
		console.log(state.properties.name);
		});


	});
	

    
	</script>
</body>
</html>